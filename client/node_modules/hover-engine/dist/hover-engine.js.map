{"version":3,"file":"hover-engine.js","sources":["../hover-engine.js"],"sourcesContent":["const values = (object) => Object.keys(object).map(key => object[key])\nconst flatMap = (allItems, items) => allItems.concat(items)\n\nclass HoverEngine {\n  constructor() {\n    this.engine = {}\n    this.store = {}\n    this.actionQueue = []\n    this.listeners = []\n    this.actions = {}\n  }\n\n  addActions(actionGroups) {\n    const addActionToEngine = (actions, action) => {\n      const newActions = (action.name in actions) ?\n        actions[action.name].concat(action) :\n        [action]\n      return Object.assign({}, actions, {[action.name]: newActions})\n    }\n\n    const addActionGroupToEngine = (actions, group) => {\n      return values(group).reduce(addActionToEngine, actions)\n    }\n\n    const getAddKeyToActionFunc = (actionGroups) => {\n      return (actionKey) => {\n        const addStoreKeyToAction = (action) => {\n          action._storeKey = actionKey\n          return action\n        }\n        return values(actionGroups[actionKey]).map(addStoreKeyToAction)\n      }\n    }\n\n    this.engine = Object.keys(actionGroups)\n      .map(getAddKeyToActionFunc(actionGroups))\n      .reduce(addActionGroupToEngine, this.engine)\n\n    const addInitObjectToStore = (store, initObject) => {\n      return Object.assign({}, store, {[initObject.key]: initObject.init()})\n    }\n\n    const actionGroupToInitObject = (actionGroupKey) => ({\n      key: actionGroupKey,\n      init: actionGroups[actionGroupKey].init\n    })\n\n    this.store = Object.keys(actionGroups)\n      .map(actionGroupToInitObject)\n      .reduce(addInitObjectToStore, this.store)\n\n    const callActions = (name, args) => {\n      const updateStoreByNextAction = (nextAction) => (store, action) => {\n        return Object.assign({}, store,\n          {[action._storeKey]: action(store[action._storeKey], nextAction.args, this.actions)}\n        )\n      }\n\n      const shouldRunQueue = this.actionQueue.length === 0\n      this.actionQueue.push({actions: this.engine[name], args: args})\n\n      // eslint-disable-next-line no-unmodified-loop-condition\n      while (shouldRunQueue && this.actionQueue.length > 0) {\n        const nextAction = this.actionQueue[0]\n        const updateStoreByAction = updateStoreByNextAction(nextAction)\n        this.store = nextAction.actions.reduce(updateStoreByAction, this.store)\n        this.actionQueue.shift()\n        this.notifyListeners(name, args)\n      }\n    }\n\n    const addActionNameToActions = (actionsObject, actionName) => {\n      return Object.assign({}, actionsObject, {[actionName]: (args) => callActions(actionName, args)})\n    }\n\n    this.actions = values(actionGroups)\n      .map(group => Object.keys(group))\n      .reduce(flatMap, [])\n      .reduce(addActionNameToActions, this.actions)\n\n    return this\n  }\n\n  addListener(listener) {\n    this.listeners.push(listener)\n\n    return this\n  }\n\n  notifyListeners(actionName, actionArguments) {\n    this.listeners.forEach(listener => listener(this.store, this.actions, actionName, actionArguments))\n\n    return this\n  }\n\n}\n\nmodule.exports = HoverEngine\n"],"names":["values","object","Object","keys","map","key","flatMap","allItems","items","concat","HoverEngine","engine","store","actionQueue","listeners","actions","actionGroups","addActionToEngine","action","newActions","name","assign","actionKey","_storeKey","getAddKeyToActionFunc","reduce","group","this","actionGroupKey","init","initObject","callActions","args","shouldRunQueue","_this","length","push","nextAction","updateStoreByAction","updateStoreByNextAction","shift","notifyListeners","actionsObject","actionName","listener","actionArguments","forEach","_this2","module","exports"],"mappings":"sfAAMA,OAAS,SAACC,UAAWC,OAAOC,KAAKF,GAAQG,IAAI,mBAAOH,EAAOI,MAC3DC,QAAU,SAACC,EAAUC,UAAUD,EAASE,OAAOD,IAE/CE,iEAEGC,eACAC,cACAC,oBACAC,kBACAC,mEAGIC,cACHC,EAAoB,SAACF,EAASG,OAC5BC,EAAcD,EAAOE,QAAQL,EACjCA,EAAQG,EAAOE,MAAMX,OAAOS,IAC3BA,UACIhB,OAAOmB,UAAWN,qBAAWG,EAAOE,KAAOD,UAiB/CR,OAAST,OAAOC,KAAKa,GACvBZ,IAX2B,SAACY,UACtB,SAACM,UAKCtB,OAAOgB,EAAaM,IAAYlB,IAJX,SAACc,YACpBK,UAAYD,EACZJ,KAONM,CAAsBR,IAC1BS,OAhB4B,SAACV,EAASW,UAChC1B,OAAO0B,GAAOD,OAAOR,EAAmBF,IAefY,KAAKhB,aAWlCC,MAAQV,OAAOC,KAAKa,GACtBZ,IAN6B,SAACwB,cAC1BA,OACCZ,EAAaY,GAAgBC,QAKlCJ,OAX0B,SAACb,EAAOkB,UAC5B5B,OAAOmB,UAAWT,qBAASkB,EAAWzB,IAAMyB,EAAWD,UAUhCF,KAAKf,WAE/BmB,EAAc,SAACX,EAAMY,OAOnBC,EAA6C,IAA5BC,EAAKrB,YAAYsB,aACnCtB,YAAYuB,MAAMrB,QAASmB,EAAKvB,OAAOS,GAAOY,KAAMA,IAGlDC,GAAkBC,EAAKrB,YAAYsB,OAAS,GAAG,KAC9CE,EAAaH,EAAKrB,YAAY,GAC9ByB,EAZwB,SAACD,UAAe,SAACzB,EAAOM,UAC/ChB,OAAOmB,UAAWT,qBACrBM,EAAOK,UAAYL,EAAON,EAAMM,EAAOK,WAAYc,EAAWL,KAAME,EAAKnB,YAUjDwB,CAAwBF,KAC/CzB,MAAQyB,EAAWtB,QAAQU,OAAOa,EAAqBJ,EAAKtB,SAC5DC,YAAY2B,UACZC,gBAAgBrB,EAAMY,iBAQ1BjB,QAAUf,OAAOgB,GACnBZ,IAAI,mBAASF,OAAOC,KAAKuB,KACzBD,OAAOnB,YACPmB,OAP4B,SAACiB,EAAeC,UACtCzC,OAAOmB,UAAWqB,qBAAiBC,EAAa,SAACX,UAASD,EAAYY,EAAYX,OAMzDL,KAAKZ,SAEhCY,yCAGGiB,eACL9B,UAAUsB,KAAKQ,GAEbjB,6CAGOgB,EAAYE,0BACrB/B,UAAUgC,QAAQ,mBAAYF,EAASG,EAAKnC,MAAOmC,EAAKhC,QAAS4B,EAAYE,KAE3ElB,cAKXqB,OAAOC,QAAUvC"}